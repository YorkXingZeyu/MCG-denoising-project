# MCG Signal Denoising with UNet1D

A PyTorch-based pipeline for magnetocardiography (MCG) signal denoising using a 1D U-Net architecture. Supports real and simulated datasets, configurable train/validation/test splitting (70/10/20), and modular utilities for metrics and visualization.

## Table of Contents

* [Project Structure](#project-structure)
* [Prerequisites](#prerequisites)
* [Requirements](#Requirements)
* [Dataset](#Dataset)
* [Data Preparation](#data-preparation)
* [Configuration](#configuration)
* [Usage](#usage)

  * [Training](#training)
  * [Evaluation](#evaluation)
* [Utilities](#utilities)
* [License](#license)

## Project Structure

```text
├── config/
│   └── base.yaml            # Default configuration parameters
├── Dataset/
│   ├── Real_Data/           # Real MCG .npy files
│   └── Simulated_Data/      # Simulated MCG .npy files
├── Data_Preparation/
│   ├── data_preparation.py  # Data loading & preprocessing
│   └── data_loader.py       # Splitting & DataLoader creation
├── utils/
│   ├── helpers.py           # Seeding & reproducibility
│   ├── metrics.py           # Evaluation metrics
│   └── plot.py              # Visualization functions
├── models/
│   └── unet1d.py            # UNet1D model definition
├── trainandtest/
│   ├── train_unet.py        # Training loop
│   └── evaluate.py          # Evaluation loop
├── main.py                  # Entry point
└── README.md                # This file
```

## Prerequisites

* Python
* PyTorch
* scikit-learn
* matplotlib
* PyYAML
* numpy

## Requirements

Save the following into `requirements.txt` and install via `pip install -r requirements.txt`:

```txt
numpy
scikit-learn
matplotlib
torch
PyYAML
einops
```

## Dataset

This repository uses [Git LFS](https://git-lfs.github.com/) to manage large `.npy` dataset files.  
Before cloning, make sure to install Git LFS:

```bash
git lfs install
git clone https://github.com/YorkXingZeyu/MCG-denoising-project.git


## Data Preparation

All data preparation lives in `Data_Preparation/`:

* data\_preparation.py: Loads raw `.npy` files, applies normalization, centering, and (optional) outlier filtering.
* data\_loader.py: Converts to PyTorch tensors, permutes to `(batch, channel, length)`.

Place your datasets under:

Dataset/Real_Data/    # noise_1280.npy, label_1280.npy
Dataset/Simulated_Data/ # noise_1280_channel3.npy, label_1280.npy
```

## Configuration

All hyperparameters are set in `config/base.yaml`:

```yaml
seed: 42
device: cuda:0
output_folder: MCG_simulated_result  # MCG_real_result or MCG_simulated_result

train:
  batch_size: 32
  lr: 0.0006
  epochs: 1000
  step_size: 1000
  gamma: 0
  early_stopping: 10
  weight_decay: 0
  unetloss_print_weight: 10
  train_model: True

test:
  batch_size: 10
  evaluate_model: True
```

## Usage

Run the full pipeline via:

```bash
python main.py --config config/base.yaml
```

### Training

* Controlled by `train.train_model` flag.
* Checkpoints and logs are saved under the specified `output_folder`.

### Evaluation

* Controlled by `test.evaluate_model` flag.
* Metrics computed in `utils/metrics.py`, plots generated by `utils/plot.py`.

## Utilities

* **helpers.py**: Fix random seeds for reproducibility.
* **metrics.py**: Compute MAE, MSE, SNR, and other denoising metrics.
* **plot.py**: Functions to visualize noisy vs. clean signals and training curves.

## License

This project is licensed under the MIT License.
